<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Refferal by Zen</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style>
        /* --- 1. RESET & BASIC THEME --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Comfortaa', cursive; }
        
        /* CUSTOM SCROLLBAR */
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: #0a0e24; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }

        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

        body {
            background-color: #000;
            background: radial-gradient(circle at 50% 10%, #101652 0%, #000000 80%);
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        body::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 3px),
                radial-gradient(white, rgba(255,255,255,.1) 1px, transparent 2px);
            background-size: 550px 550px, 350px 350px; background-position: 0 0, 40px 60px; opacity: 0.3; z-index: -1;
        }

        /* --- 2. HEADER --- */
        header { 
            margin-top: 30px; 
            text-align: center; 
            z-index: 2; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 20px; 
            position: relative; 
            width: 100%; 
            padding: 0 15px;
        }
        
        h1 { 
            font-size: 1.8rem;
            font-weight: 700; 
            letter-spacing: -1px; 
            text-shadow: 0 0 25px rgba(0, 140, 255, 0.6); 
            background: linear-gradient(180deg, #ffffff, #00bfff); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }

        .toggle-capsule { 
            display: flex; 
            background: rgba(255, 255, 255, 0.03); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(15px); 
            padding: 4px; 
            border-radius: 100px; 
            width: 100%; 
            max-width: 340px; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); 
            cursor: pointer; 
        }
        .toggle-btn { 
            flex: 1; 
            padding: 10px 0; 
            text-align: center; 
            border-radius: 100px; 
            font-weight: 700; 
            font-size: 0.8rem; 
            transition: all 0.4s ease; 
            color: #8892b0; 
        }
        .toggle-btn.active { 
            color: #fff; 
            background: linear-gradient(90deg, #00c6ff, #0072ff); 
            box-shadow: 0 0 20px rgba(0, 114, 255, 0.4); 
            border: 1px solid rgba(255,255,255,0.2); 
        }

        .admin-trigger { 
            position: absolute; top: 0; right: 15px; 
            width: 40px; height: 40px; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            cursor: pointer; color: #8892b0; opacity: 0.7; transition: 0.3s; 
            border: 1px solid rgba(255,255,255,0.1); 
        }
        .admin-trigger:hover { color: #00c6ff; border-color: #00c6ff; opacity: 1; }

        /* --- 3. MAIN CONTENT --- */
        .main-content { 
            flex: 1; 
            width: 95%; 
            max-width: 800px; 
            margin: 20px 0; 
            padding: 20px; 
            border-radius: 20px; 
            background: rgba(255, 255, 255, 0.02); 
            border: 1px solid rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(10px); 
            min-height: 400px; 
            position: relative; 
        }
        .tab-view { display: none; animation: fadeIn 0.5s ease; }
        .tab-view.active-view { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 4. LEADERBOARD --- */
        .leaderboard-container { display: flex; flex-direction: column; gap: 12px; margin-top: 10px; }
        .group-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; overflow: hidden; transition: 0.3s; }
        .group-card:hover { border-color: rgba(0, 198, 255, 0.4); background: rgba(255,255,255,0.05); }
        .group-header { display: flex; align-items: center; padding: 15px; cursor: pointer; justify-content: space-between; }
        .rank-badge { width: 35px; height: 35px; border-radius: 10px; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1rem; color: #8892b0; margin-right: 12px; flex-shrink: 0; }
        .group-card.top-1 .rank-badge { background: linear-gradient(135deg, #ffd700, #ffaa00); color: #000; box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); }
        .group-card.top-2 .rank-badge { background: linear-gradient(135deg, #e0e0e0, #b0b0b0); color: #000; }
        .group-card.top-3 .rank-badge { background: linear-gradient(135deg, #cd7f32, #a05a2c); color: #000; }
        .group-info { flex: 1; overflow: hidden; }
        .group-code { font-size: 1rem; font-weight: 800; color: #fff; letter-spacing: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .group-label { font-size: 0.65rem; color: #8892b0; text-transform: uppercase; letter-spacing: 1px; margin-top: 2px;}
        .count-pill { background: rgba(0, 198, 255, 0.1); color: #00c6ff; padding: 4px 10px; border-radius: 50px; font-size: 0.75rem; font-weight: 700; border: 1px solid rgba(0, 198, 255, 0.2); margin-right: 8px; flex-shrink: 0;}
        .slide-icon { transition: transform 0.3s; width: 20px; color: #555; }
        .group-card.open .slide-icon { transform: rotate(180deg); color: #fff; }
        .email-list-container { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; background: rgba(0,0,0,0.3); border-top: 1px solid rgba(255,255,255,0.05); }
        .email-list-inner { padding: 15px; }
        .revenue-summary-box { background: linear-gradient(135deg, rgba(0, 255, 136, 0.05) 0%, rgba(0, 0, 0, 0.2) 100%); border: 1px solid rgba(0, 255, 136, 0.2); border-radius: 12px; padding: 15px; margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .rev-label { font-size: 0.7rem; color: #8892b0; text-transform: uppercase; letter-spacing: 1px; }
        .rev-amount { font-size: 1.5rem; font-weight: 800; color: #00ff88; margin: 5px 0; text-shadow: 0 0 20px rgba(0, 255, 136, 0.3); }
        .rev-note { font-size: 0.7rem; color: #ffd700; font-weight: 600; display: flex; align-items: center; gap: 5px;}
        .email-item { padding: 8px 0; border-bottom: 1px dashed rgba(255,255,255,0.1); color: #ccc; font-size: 0.85rem; display: flex; align-items: center; gap: 10px; word-break: break-all; }
        .email-item:last-child { border-bottom: none; }
        .email-item::before { content: "â€¢"; color: #00c6ff; font-size: 1.5rem; line-height: 0; }

        /* --- 5. PROGRESS & RULES --- */
        .level-wrapper { position: relative; padding: 20px 0; margin-bottom: 20px; }
        .level-track { position: absolute; top: 50%; left: 5px; right: 5px; height: 4px; background: rgba(255,255,255,0.1); transform: translateY(-50%); z-index: 0; border-radius: 10px; }
        .level-fill { position: absolute; top: 0; left: 0; height: 100%; width: 100%; background: linear-gradient(90deg, #00c6ff 0%, #ffd700 100%); border-radius: 10px; opacity: 0.8; }
        .level-nodes { position: relative; z-index: 1; display: flex; justify-content: space-between; gap: 5px; }
        .level-node { display: flex; flex-direction: column; align-items: center; text-align: center; width: 33%; position: relative; }
        .node-dot { width: 16px; height: 16px; border-radius: 50%; background: #000; border: 2px solid #555; margin-bottom: 10px; transition: 0.3s; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
        .level-node.active .node-dot { background: #00c6ff; border-color: #fff; box-shadow: 0 0 15px #00c6ff; }
        .level-node.gold .node-dot { background: #ffd700; border-color: #fff; box-shadow: 0 0 20px #ffd700; width: 20px; height: 20px; }
        .node-card { background: rgba(16, 22, 50, 0.9); border: 1px solid rgba(255,255,255,0.1); padding: 8px 5px; border-radius: 10px; width: 100%; max-width: 140px; transition: transform 0.3s; }
        .level-node.gold .node-card { border-color: rgba(255, 215, 0, 0.4); background: linear-gradient(145deg, rgba(255,215,0,0.05), rgba(0,0,0,0.8)); }
        .node-title { font-size: 0.65rem; color: #8892b0; margin-bottom: 3px; text-transform: uppercase; letter-spacing: 1px; }
        .node-reward { font-size: 0.9rem; font-weight: 800; color: #fff; }
        .node-desc { font-size: 0.6rem; color: #00c6ff; margin-top: 2px; }
        .level-node.gold .node-reward { color: #ffd700; text-shadow: 0 0 10px rgba(255,215,0,0.3); }
        .level-node.gold .node-desc { color: #ffd700; }
        
        .rate-info-box { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 30px; }
        .rate-card { flex: 1; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); padding: 10px; border-radius: 10px; text-align: center; }
        .rate-cond { display: block; font-size: 0.65rem; color: #8892b0; margin-bottom: 4px; }
        .rate-val { font-size: 0.9rem; font-weight: 700; }
        
        .quest-log { display: flex; flex-direction: column; gap: 10px; }
        .quest-item { background: rgba(255,255,255,0.03); border-left: 3px solid #555; padding: 12px; border-radius: 0 8px 8px 0; display: flex; gap: 10px; align-items: start; }
        .quest-item.active { border-left-color: #00c6ff; background: linear-gradient(90deg, rgba(0,198,255,0.05), transparent); }
        .quest-item.gold { border-left-color: #ffd700; background: linear-gradient(90deg, rgba(255, 215, 0, 0.05), transparent); }
        .quest-item.danger { border-left-color: #ff6b6b; background: linear-gradient(90deg, rgba(255,107,107,0.05), transparent); }
        .quest-icon { width: 20px; color: #8892b0; flex-shrink: 0; margin-top: 2px; }
        .quest-item.active .quest-icon { color: #00c6ff; }
        .quest-text { font-size: 0.8rem; color: #ccc; line-height: 1.4; }
        .quest-text strong { color: #fff; }
        .spec-list { margin-top: 5px; padding-left: 15px; list-style: disc; color: #aaa; font-size: 0.75rem; }
        .code-box { background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; font-family: monospace; color: #fff; border: 1px solid rgba(255,255,255,0.2); display: inline-block; margin-top: 3px; font-size: 0.85em; word-break: break-all;}

        /* --- 6. FORM & CALCULATOR --- */
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; color: #00c6ff; margin-bottom: 8px; font-weight: 700; font-size: 0.85rem; }
        .input-wrapper { position: relative; }
        .input-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #8892b0; width: 18px; pointer-events: none; }
        .form-input { width: 100%; padding: 12px 12px 12px 40px; background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; color: #fff; font-size: 1rem; transition: all 0.3s; }
        .form-input:focus { outline: none; border-color: #00c6ff; box-shadow: 0 0 15px rgba(0, 198, 255, 0.2); background: rgba(0, 0, 0, 0.6); }

        .calc-result-box { background: linear-gradient(135deg, #151932 0%, #0a0e24 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 20px; margin-top: 25px; position: relative; overflow: hidden; }
        .calc-rate-badge { position: absolute; top: 12px; right: 12px; background: rgba(255,255,255,0.1); color: #8892b0; padding: 4px 8px; border-radius: 6px; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; border: 1px solid rgba(255,255,255,0.1); transition: 0.3s; }
        .calc-rate-badge.active-gold { background: rgba(255, 215, 0, 0.15); color: #ffd700; border-color: #ffd700; box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }
        .calc-header { font-size: 0.8rem; color: #8892b0; margin-bottom: 5px; }
        .result-amount { font-size: 2rem; font-weight: 800; color: #fff; margin-bottom: 12px; letter-spacing: -1px; }
        .calc-progress-bg { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; position: relative; overflow: hidden; margin-bottom: 10px; }
        .calc-progress-fill { height: 100%; width: 0%; background: #00c6ff; border-radius: 10px; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .calc-progress-fill.full { background: #ffd700; box-shadow: 0 0 10px #ffd700; }
        .calc-breakdown { font-size: 0.75rem; color: #666; display: flex; justify-content: space-between; }
        .calc-breakdown span.highlight { color: #00c6ff; }
        .result-bonus { display: none; margin-top: 5px; font-weight: 700; font-size: 0.75rem; color: #ffd700; }
        .result-bonus.active { display: block; animation: pulse 1.5s infinite; }

        .btn-submit { display: block; width: 100%; padding: 14px; margin-top: 20px; background: linear-gradient(90deg, #00c6ff, #0072ff); border: none; border-radius: 12px; color: #fff; font-weight: 700; font-size: 1rem; cursor: pointer; text-align: center; text-decoration: none; box-shadow: 0 5px 20px rgba(0, 114, 255, 0.3); transition: transform 0.2s; }
        .btn-submit:active { transform: scale(0.98); }

        /* VIRTUAL CARD */
        .card-preview-container { perspective: 1000px; margin-bottom: 25px; display: flex; justify-content: center; width: 100%; }
        .virtual-card { width: 100%; max-width: 340px; aspect-ratio: 1.6/1; background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); border-radius: 16px; position: relative; overflow: hidden; border: 1px solid rgba(255,255,255,0.15); box-shadow: 0 15px 35px rgba(0,0,0,0.5); transition: transform 0.5s; }
        .virtual-card::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(60deg, transparent, rgba(255,255,255,0.1), transparent); transform: rotate(25deg); pointer-events: none; }
        .v-card-top { display: flex; justify-content: space-between; padding: 15px; align-items: center; }
        .v-brand { font-size: 0.8rem; font-weight: 700; color: #00c6ff; letter-spacing: 1px; text-transform: uppercase; }
        .v-chip { width: 35px; height: 25px; background: linear-gradient(135deg, #d4af37, #f9d976); border-radius: 4px; position: relative; overflow: hidden; border: 1px solid rgba(0,0,0,0.2); }
        .v-chip::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 1px solid rgba(0,0,0,0.3); border-radius: 4px; background-image: repeating-linear-gradient(90deg, transparent, transparent 10px, rgba(0,0,0,0.2) 10px, rgba(0,0,0,0.2) 11px); }
        .v-card-body { padding: 0 15px; margin-top: 5px; }
        .v-label { font-size: 0.6rem; color: #8892b0; text-transform: uppercase; letter-spacing: 2px; }
        .v-code { font-family: 'Share Tech Mono', monospace; font-size: 1.5rem; color: #fff; text-shadow: 0 0 10px rgba(0, 198, 255, 0.8); letter-spacing: 2px; margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-transform: uppercase; }
        .v-card-footer { position: absolute; bottom: 0; width: 100%; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); backdrop-filter: blur(5px); border-top: 1px solid rgba(255,255,255,0.05); }
        .v-status { color: #ffd700; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
        .v-logo-icon { width: 24px; opacity: 0.8; }

        /* --- 7. OVERLAYS --- */
        .fab-lapor { position: fixed; bottom: 20px; right: 20px; background: linear-gradient(135deg, #00c6ff, #0072ff); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; box-shadow: 0 10px 30px rgba(0, 114, 255, 0.5); cursor: pointer; z-index: 90; transition: transform 0.3s, box-shadow 0.3s; }
        .fab-lapor:active { transform: scale(0.9); }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 100; display: none; justify-content: center; align-items: center; padding: 15px; }
        .overlay.open { display: flex; animation: fadeIn 0.3s; }
        .modal-box { background: linear-gradient(145deg, #1a1f3c, #0a0e24); border: 1px solid rgba(0, 198, 255, 0.3); border-radius: 20px; padding: 25px 20px; width: 100%; max-width: 450px; position: relative; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .close-btn { position: absolute; top: 15px; right: 15px; color: #ff6b6b; cursor: pointer; font-size: 1.2rem; font-weight: bold; background: rgba(255,255,255,0.05); width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        /* --- 8. ADMIN PANEL STYLES --- */
        .admin-modal { width: 100%; height: 100vh; background: rgba(20, 20, 30, 1); position: relative; display: flex; flex-direction: column; overflow: hidden; border-radius: 0; }
        .admin-table-container { flex: 1; overflow-y: auto; overflow-x: auto; padding: 10px; padding-bottom: 90px; }
        .admin-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        .admin-table th { position: sticky; top: 0; background: rgba(20, 20, 30, 0.95); z-index: 2; padding: 10px; text-align: left; color: #00c6ff; text-transform: uppercase; font-size: 0.7rem; border-bottom: 2px solid rgba(255,255,255,0.1); white-space: nowrap; }
        .admin-table td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); color: #ccc; }
        .admin-table tr:hover { background: rgba(255,255,255,0.03); }
        
        .admin-dock { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; padding: 8px 15px; background: rgba(20, 20, 30, 0.9); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 10; width: max-content; }
        .dock-item { width: 40px; height: 40px; border-radius: 50%; border: none; background: rgba(255,255,255,0.05); color: #fff; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; position: relative; }
        .dock-item:active { transform: scale(0.9); }
        .dock-item.add { background: #00c6ff; color: #000; }
        .dock-item.codes { background: #d400ff; color: #fff; } 
        .dock-item.delete { background: #ff6b6b; color: #fff; opacity: 0.5; pointer-events: none; }
        .dock-item.delete.active { opacity: 1; pointer-events: auto; }
        
        .action-dialog { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #151520; border: 1px solid rgba(0, 198, 255, 0.4); padding: 20px; border-radius: 20px; width: 90%; max-width: 320px; display: none; flex-direction: column; gap: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.8); z-index: 20; }
        .action-dialog.show { display: flex; animation: fadeIn 0.2s; }
        
        .admin-input-wrapper { position: relative; width: 100%; margin-bottom:5px; }
        .admin-input-icon { position: absolute; left: 12px; top: 12px; width: 16px; color: #8892b0; pointer-events: none; }
        .admin-input-clean { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 10px 10px 10px 35px; border-radius: 8px; color: #fff; outline: none; width: 100%; font-size: 0.9rem; }
        .admin-textarea { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 10px 10px 10px 35px; border-radius: 8px; color: #fff; outline: none; width: 100%; height: 100px; resize: vertical; font-family: 'Comfortaa', cursive; font-size: 0.9rem; }
        .admin-select { background: #1a1f3c; border: 1px solid rgba(255,255,255,0.1); padding: 10px 10px 10px 35px; border-radius: 8px; color: #fff; outline: none; width: 100%; cursor: pointer; font-size: 0.9rem; }
        .code-list { max-height: 120px; overflow-y: auto; display: flex; flex-direction: column; gap: 4px; margin-top: 5px; }
        .code-item { background: rgba(255,255,255,0.05); padding: 8px 10px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; }
        .code-del-btn { color: #ff6b6b; cursor: pointer; font-weight: bold; padding: 2px 5px; }
        .btn-action { background: none; border: none; cursor: pointer; padding: 5px; opacity: 0.8; }
        
        /* SEARCH BAR */
        .search-container { padding: 15px 15px 5px; display:flex; align-items:center; }
        .section-title { font-size: 0.95rem; color: #00c6ff; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }
        .icon { width: 18px; height: 18px; stroke-width: 2.5; fill: none; stroke: currentColor; stroke-linecap: round; stroke-linejoin: round; }
        .text-cyan { color: #00c6ff; } .text-gold { color: #ffd700; } .text-red { color: #ff6b6b; }

        /* Media Queries untuk HP Sangat Kecil (< 360px) */
        @media screen and (max-width: 360px) {
            h1 { font-size: 1.5rem; }
            .v-code { font-size: 1.2rem; }
            .node-title { font-size: 0.55rem; }
            .node-reward { font-size: 0.75rem; }
            .main-content { padding: 15px; }
            .rank-badge { width: 30px; height: 30px; font-size: 0.9rem; margin-right: 8px; }
            .email-item { font-size: 0.75rem; }
        }
    </style>
</head>
<body>

    <header>
        <div class="admin-trigger" onclick="checkAdminAccess()">
            <svg class="icon" viewBox="0 0 24 24"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>
        </div>
        <h1>Refferal by Zen</h1>
        <div class="toggle-capsule">
            <div id="tab-database" class="toggle-btn active" onclick="switchTab('database')">Database</div>
            <div id="tab-detail" class="toggle-btn" onclick="switchTab('detail')">Detail</div>
            <div id="tab-gabung" class="toggle-btn" onclick="switchTab('gabung')">Gabung</div>
        </div>
    </header>

    <div class="fab-lapor" onclick="toggleOverlay('lapor-modal')">
        <svg class="icon" viewBox="0 0 24 24" style="width:24px; height:24px;"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
    </div>

    <div class="main-content">
        <div id="view-detail" class="tab-view">
            <h2 class="section-title"><svg class="icon text-cyan" viewBox="0 0 24 24"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg> Progress Roadmap</h2>
            <div class="level-wrapper">
                <div class="level-track"><div class="level-fill"></div></div>
                <div class="level-nodes">
                    <div class="level-node active"><div class="node-dot"></div><div class="node-card"><div class="node-title">Level 0</div><div class="node-reward">Start</div></div></div>
                    <div class="level-node active"><div class="node-dot"></div><div class="node-card"><div class="node-title">Level 1</div><div class="node-reward">560rb</div><div class="node-desc">10 Users</div></div></div>
                    <div class="level-node gold"><div class="node-dot"></div><div class="node-card"><div class="node-title">Level MAX</div><div class="node-reward">1.12jt</div><div class="node-desc">20 Users++</div></div></div>
                </div>
            </div>
            
            <div class="rate-info-box">
                <div class="rate-card"><span class="rate-cond">Ganjil (Basic)</span><span class="rate-val text-cyan">48rb / user</span></div>
                <div class="rate-card" style="border-color: rgba(255, 215, 0, 0.2);"><span class="rate-cond">Genap (Upgrade)</span><span class="rate-val text-gold">64rb / user</span></div>
            </div>
            
            <h2 class="section-title" style="margin-top:20px;"><svg class="icon text-cyan" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg> Syarat dan Ketentuan</h2>
            <div class="quest-log">
                <div class="quest-item active"><svg class="quest-icon icon" viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg><div class="quest-text"><strong>Edukasi User:</strong> Pengundang wajib menjelaskan detail sewa & pembayaran kepada calon user.</div></div>
                <div class="quest-item gold"><svg class="quest-icon icon" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg><div class="quest-text"><strong>Spesifikasi Akun:</strong><ul class="spec-list"><li>Wajib Akun Indonesia ðŸ‡®ðŸ‡©</li><li>Min. 30 Koneksi & Pembuatan Min. Des 2024</li><li>Dilarang mengaktifkan 2FA ðŸš«</li></ul></div></div>
                <div class="quest-item active"><svg class="quest-icon icon" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg><div class="quest-text"><strong>Lapor Misi:</strong> Setelah sukses rental, wajib lapor admin. Format: <span class="code-box">[ bang aku di undang kode nice099 ya ]</span></div></div>
                <div class="quest-item danger"><svg class="quest-icon icon" viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg><div class="quest-text"><strong>Dilarang Nuyul:</strong> Curang = Cut Off Tanpa Pemberitahuan</div></div>
            </div>
        </div>

        <div id="view-database" class="tab-view active-view">
            <h2 class="section-title" style="margin-bottom:15px">Leaderboard</h2>
            <div id="leaderboardList" class="leaderboard-container"><div style="text-align:center; padding:30px; color:#888;">Memuat data...</div></div>
            <div style="text-align:center; margin-top:20px; font-size:0.75rem; color:#888;">Gunakan tombol <strong style="color:#00c6ff">+</strong> di kanan bawah untuk melapor.</div>
        </div>

        <div id="view-gabung" class="tab-view">
            <h2 class="section-title"><svg class="icon text-cyan" viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><polyline points="17 11 19 13 23 9"></polyline></svg> Bergabung Sekarang</h2>
            <div class="card-preview-container">
                <div class="virtual-card">
                    <div class="v-card-top"><div class="v-brand">REFFERAL BY ZEN</div><div class="v-chip"></div></div>
                    <div class="v-card-body"><div class="v-label">Unique Code</div><div class="v-code" id="displayCardCode">ZEN-MEMBER</div></div>
                    <div class="v-card-footer"><div class="v-status">OFFICIAL PARTNER</div><svg class="v-logo-icon" viewBox="0 0 24 24" fill="white"><circle cx="12" cy="12" r="10"></circle><path d="M8 12l2 2 4-4" stroke="black" stroke-width="2" fill="none"></path></svg></div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Request Kode Unik</label>
                <div class="input-wrapper">
                    <svg class="icon input-icon" viewBox="0 0 24 24"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
                    <input type="text" id="reqCode" class="form-input" placeholder="Contoh: nice099" oninput="updateCard()">
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Target Undangan (Mingguan)</label>
                <div class="input-wrapper">
                    <svg class="icon input-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="3"></circle></svg>
                    <input type="number" id="reqTarget" class="form-input" placeholder="0" oninput="calc()">
                </div>
            </div>

            <div class="calc-result-box">
                <div id="calcRateBadge" class="calc-rate-badge">Zigzag 48/64</div>
                <div class="calc-header">Estimasi Profit</div>
                <div class="result-amount" id="calcTotal">IDR 0</div>
                <div class="calc-progress-bg"><div id="calcProgress" class="calc-progress-fill"></div></div>
                <div class="calc-breakdown">
                    <span id="calcBreakdownText">0 User</span>
                    <span id="calcNextTarget">Next: 20 User</span>
                </div>
                <div id="calcBonus" class="result-bonus">âœ¨ BONUS TARGET DIAKTIFKAN!</div>
            </div>

            <button class="btn-submit" onclick="joinWa()">Kirim Request Kode</button>
        </div>
    </div>

    <div id="lapor-modal" class="overlay">
        <div class="modal-box">
            <div class="close-btn" onclick="toggleOverlay('lapor-modal')">x</div>
            <h2 class="section-title" style="justify-content:center;">Lapor Referral</h2>
            <div class="form-group">
                <label class="form-label">Kode Referral</label>
                <div class="input-wrapper">
                    <svg class="icon input-icon" viewBox="0 0 24 24"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
                    <input type="text" id="lapKode" class="form-input" placeholder="Contoh: nice099">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Email User</label>
                <div class="input-wrapper">
                    <svg class="icon input-icon" viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                    <input type="email" id="lapEmail" class="form-input" placeholder="user@gmail.com">
                </div>
            </div>
            <button class="btn-submit" onclick="laporWa()">Kirim WA</button>
        </div>
    </div>

    <div id="admin-panel" class="overlay">
        <div class="admin-modal">
            
            <div class="search-container">
                <div class="admin-input-wrapper" style="margin-bottom:0">
                    <svg class="admin-input-icon icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    <input type="text" id="adminSearch" class="admin-input-clean" placeholder="Cari Email / Kode..." onkeyup="renderAdminTable()">
                </div>
            </div>

            <div class="admin-table-container">
                <table class="admin-table">
                    <thead><tr><th style="width:30px; text-align:center;"><input type="checkbox" id="checkAll" onchange="toggleAll(this)"></th><th>Kode</th><th>Email User</th><th style="text-align:right">Act</th></tr></thead>
                    <tbody id="adminTableBody"></tbody>
                </table>
            </div>
            <div class="admin-dock">
                <button class="dock-item add" onclick="openAction('add')" data-tooltip="Tambah"><svg class="icon" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg></button>
                <button class="dock-item codes" onclick="openAction('codes')" data-tooltip="Kode"><svg class="icon" viewBox="0 0 24 24"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg></button>
                <button class="dock-item" onclick="openAction('filter')" data-tooltip="Filter"><svg class="icon" viewBox="0 0 24 24"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg></button>
                <button class="dock-item" onclick="fetchAdminData()" data-tooltip="Refresh"><svg class="icon" viewBox="0 0 24 24"><path d="M23 4v6h-6"></path><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg></button>
                <button class="dock-item delete" id="dockDelete" onclick="massDelete()" data-tooltip="Hapus"><svg class="icon" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>
                <div style="width:1px; height:20px; background:rgba(255,255,255,0.2); margin:0 2px;"></div>
                <button class="dock-item" onclick="toggleOverlay('admin-panel')" data-tooltip="Tutup" style="background:rgba(255,100,100,0.2); color:#ff6b6b;"><svg class="icon" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
            </div>
            <div id="dialog-add" class="action-dialog">
                <h4 style="text-align:center; color:#fff; margin-bottom:5px;">Input Data</h4>
                <div>
                    <div class="admin-input-wrapper">
                        <svg class="admin-input-icon icon" viewBox="0 0 24 24"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
                        <select id="admKode" class="admin-select"><option value="">-- Pilih Kode --</option></select>
                    </div>
                </div>
                <div>
                    <div class="admin-input-wrapper">
                        <svg class="admin-input-icon icon" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                        <textarea id="admEmail" class="admin-textarea" placeholder="Paste teks panjang di sini..."></textarea>
                    </div>
                </div>
                <input type="hidden" id="admEditIndex" value="-1">
                <div style="display:flex; gap:10px;"><button class="btn-submit" onclick="saveData()" style="margin-top:0; font-size:0.9rem;">Simpan</button><button class="btn-submit" onclick="closeAction('add')" style="margin-top:0; background:#444; font-size:0.9rem;">Batal</button></div>
            </div>
            <div id="dialog-codes" class="action-dialog">
                <h4 style="text-align:center; color:#fff; margin-bottom:5px;">Master Kode</h4>
                <div style="display:flex; gap:5px;">
                    <div class="admin-input-wrapper">
                        <svg class="admin-input-icon icon" viewBox="0 0 24 24"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
                        <input type="text" id="newCodeInput" class="admin-input-clean" placeholder="Tambah Kode...">
                    </div>
                    <button onclick="addNewCode()" style="background:#d400ff; border:none; border-radius:8px; width:40px; color:#fff; cursor:pointer;">+</button>
                </div>
                <div id="codeListContainer" class="code-list"></div>
                <button class="btn-submit" onclick="closeAction('codes')" style="margin-top:10px; background:#444; font-size:0.9rem;">Tutup</button>
            </div>
            <div id="dialog-filter" class="action-dialog">
                <h4 style="text-align:center; color:#fff; margin-bottom:5px;">Manage by Code</h4>
                <div class="admin-input-wrapper">
                    <svg class="admin-input-icon icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    <input type="text" id="filterKode" class="admin-input-clean" placeholder="Kode (ex: nice099)">
                </div>
                <div style="display:flex; gap:10px; flex-direction:column;">
                    <button class="btn-submit" onclick="copyFilteredEmails()" style="margin-top:0; font-size:0.9rem; background:#ffd700; color:#000;">Salin Email</button>
                    <button class="btn-submit" onclick="massDeleteByCode()" style="margin-top:0; font-size:0.9rem; background:#ff6b6b; color:#fff;">Hapus Massal</button>
                    <button class="btn-submit" onclick="closeAction('filter')" style="margin-top:0; background:#444; font-size:0.9rem;">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const BIN_ID = "6967465dd0ea881f406adee4";
        const API_KEY = "$2a$10$4v5UzmjJBEf7T6RUlR7CfeJERCrf/waXNcO7pxUk3OYGOzBNLJ7Fy";
        let localUsers = [], localCodes = []; 

        function switchTab(name) {
            ['detail', 'database', 'gabung'].forEach(t => {
                document.getElementById('tab-'+t).classList.remove('active');
                document.getElementById('view-'+t).classList.remove('active-view');
            });
            document.getElementById('tab-'+name).classList.add('active');
            document.getElementById('view-'+name).classList.add('active-view');
            if(name === 'database') fetchPublicData();
        }

        function checkAdminAccess() {
            let pass = prompt("Masukkan Sandi Admin:");
            if(pass === "2003") {
                toggleOverlay('admin-panel');
            } else if(pass !== null) {
                alert("Sandi Salah!");
            }
        }

        function toggleOverlay(id) {
            const el = document.getElementById(id);
            if(el.style.display === 'flex') {
                el.style.display = 'none';
                if(id === 'admin-panel') { closeAction('add'); closeAction('codes'); closeAction('filter'); }
            } else {
                el.style.display = 'flex';
                if(id === 'admin-panel') fetchAdminData();
            }
        }

        async function fetchPublicData() {
            const listContainer = document.getElementById('leaderboardList');
            listContainer.innerHTML = '<div style="text-align:center; padding:30px; color:#888;">Memuat data terbaru...</div>';
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { 'X-Master-Key': API_KEY } });
                const data = await res.json();
                localUsers = data.record.users || [];
                
                listContainer.innerHTML = '';
                if(localUsers.length === 0) { listContainer.innerHTML = '<div style="text-align:center; padding:30px; color:#888;">Belum ada data partner.</div>'; return; }

                const groups = {};
                localUsers.forEach(u => { if(!groups[u.code]) groups[u.code] = []; groups[u.code].push(u.email); });
                const sortedCodes = Object.keys(groups).sort((a,b) => groups[b].length - groups[a].length);

                sortedCodes.forEach((code, i) => {
                    let rankClass = i===0?'top-1':(i===1?'top-2':(i===2?'top-3':''));
                    const emails = groups[code];
                    const count = emails.length;
                    
                    // --- NEW LOGIC: Loop 48rb, 64rb ---
                    let pairs = Math.floor(count / 2);
                    let remainder = count % 2;
                    let revenue = (pairs * (48000 + 64000)) + (remainder * 48000);
                    // ---------------------------------

                    let revFmt = new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(revenue);

                    const emailListHTML = emails.map(e => `<div class="email-item">${e}</div>`).join('');
                    const uid = `group-${i}`;

                    listContainer.innerHTML += `
                        <div class="group-card ${rankClass}" id="card-${uid}">
                            <div class="group-header" onclick="toggleEmails('${uid}')">
                                <div style="display:flex; align-items:center; overflow:hidden;">
                                    <div class="rank-badge">#${i+1}</div>
                                    <div class="group-info"><div class="group-code">${code}</div><div class="group-label">Referral Code</div></div>
                                </div>
                                <div style="display:flex; align-items:center;"><div class="count-pill">${count} User</div><svg class="icon slide-icon" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"></polyline></svg></div>
                            </div>
                            <div id="${uid}" class="email-list-container">
                                <div class="email-list-inner">
                                    <div class="revenue-summary-box">
                                        <div class="rev-label">Total Pendapatan</div><div class="rev-amount">${revFmt}</div>
                                        <div style="font-size:0.75rem; color:#666">Pola: 48rb - 64rb - 48rb...</div>
                                    </div>
                                    <div style="margin-top:10px;">${emailListHTML}</div>
                                </div>
                            </div>
                        </div>`;
                });
            } catch(e) { listContainer.innerHTML = `<div style="text-align:center; padding:30px; color:#ff6b6b;">Gagal memuat data.</div>`; }
        }

        function toggleEmails(id) {
            const el = document.getElementById(id), card = document.getElementById('card-' + id);
            if (el.style.maxHeight) { el.style.maxHeight = null; card.classList.remove('open'); }
            else { el.style.maxHeight = el.scrollHeight + "px"; card.classList.add('open'); }
        }

        function openAction(type) {
            document.querySelectorAll('.action-dialog').forEach(el => el.classList.remove('show'));
            document.getElementById('dialog-' + type).classList.add('show');
            if(type === 'add') updateSelectOptions();
            if(type === 'codes') renderCodeList();
        }
        function closeAction(type) { document.getElementById('dialog-' + type).classList.remove('show'); }

        function updateSelectOptions() {
            const sel = document.getElementById('admKode'); sel.innerHTML = '<option value="">-- Pilih Kode --</option>';
            localCodes.forEach(c => { const opt = document.createElement('option'); opt.value = c; opt.innerText = c; sel.appendChild(opt); });
        }

        async function fetchAdminData() {
            const tbody = document.getElementById('adminTableBody'); tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:20px;">Syncing...</td></tr>';
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { 'X-Master-Key': API_KEY } });
                const data = await res.json();
                localUsers = data.record.users || []; localCodes = data.record.codes || [];
                renderAdminTable();
            } catch (e) { alert("Error: " + e.message); }
        }

        function renderAdminTable() {
            const tbody = document.getElementById('adminTableBody'); 
            tbody.innerHTML = '';
            const searchTerm = document.getElementById('adminSearch').value.toLowerCase();
            let filteredData = localUsers.map((u, i) => ({ ...u, originalIndex: i }))
                                         .filter(u => u.email.toLowerCase().includes(searchTerm) || u.code.toLowerCase().includes(searchTerm));

            if(filteredData.length === 0) { 
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:30px; color:#555;">Data tidak ditemukan</td></tr>'; 
                return; 
            }

            filteredData.forEach((u) => {
                tbody.innerHTML += `<tr>
                    <td style="text-align:center"><input type="checkbox" class="row-check" value="${u.originalIndex}" onchange="checkMassDeleteState()"></td>
                    <td><span style="color:#00c6ff; font-family:monospace">${u.code}</span></td><td>${u.email}</td>
                    <td style="text-align:right"><button class="btn-action" style="color:#ffd700" onclick="editData(${u.originalIndex})"><svg class="icon" viewBox="0 0 24 24" style="width:16px;height:16px"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button class="btn-action" style="color:#ff6b6b" onclick="deleteData(${u.originalIndex})"><svg class="icon" viewBox="0 0 24 24" style="width:16px;height:16px"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button></td>
                </tr>`;
            });
            checkMassDeleteState();
        }

        function renderCodeList() {
            const cont = document.getElementById('codeListContainer'); cont.innerHTML = '';
            if(localCodes.length === 0) cont.innerHTML = '<div style="text-align:center; color:#555; font-size:0.75rem;">Belum ada kode master.</div>';
            localCodes.forEach((c, i) => { cont.innerHTML += `<div class="code-item"><span style="color:#00c6ff;">${c}</span><span class="code-del-btn" onclick="deleteCode(${i})">x</span></div>`; });
        }

        async function addNewCode() {
            const inp = document.getElementById('newCodeInput'), val = inp.value.trim();
            if(!val || localCodes.includes(val)) return alert("Kode tidak valid atau sudah ada");
            localCodes.push(val); inp.value = ''; renderCodeList(); await pushToBinAll();
        }
        async function deleteCode(i) { if(!confirm("Hapus kode?")) return; localCodes.splice(i, 1); renderCodeList(); await pushToBinAll(); }

        async function saveData() {
            const c = document.getElementById('admKode').value, raw = document.getElementById('admEmail').value, idx = parseInt(document.getElementById('admEditIndex').value);
            if(!c || !raw.trim()) return alert("Data tidak lengkap");
            const emails = raw.match(/[\w.-]+@[\w.-]+\.[a-zA-Z]{2,}/g) || [];
            if(!emails.length) return alert("Email tidak valid");

            const dups = emails.filter(ne => localUsers.some((ex, i) => (idx !== -1 && i === idx ? false : ex.email.toLowerCase() === ne.toLowerCase())));
            if(dups.length) return alert(`Email duplikat:\n${dups.join('\n')}`);

            const btns = document.querySelectorAll('.btn-submit'); btns.forEach(b => b.innerText = 'Saving...');
            if(idx !== -1) localUsers[idx] = { code: c, email: emails[0] };
            else emails.forEach(e => localUsers.push({ code: c, email: e }));

            await pushToBinAll();
            btns.forEach(b => b.innerText = 'Simpan');
            document.getElementById('admEmail').value = ''; document.getElementById('admEditIndex').value = -1;
            closeAction('add'); renderAdminTable(); alert(`Berhasil: ${emails.length} data.`);
        }

        function editData(i) {
            document.getElementById('admEditIndex').value = i;
            document.getElementById('admEmail').value = localUsers[i].email;
            updateSelectOptions();
            document.getElementById('admKode').value = localUsers[i].code;
            openAction('add');
        }

        async function deleteData(i) { if(confirm("Hapus?")) { localUsers.splice(i, 1); renderAdminTable(); await pushToBinAll(); } }
        
        function toggleAll(src) { document.querySelectorAll('.row-check').forEach(c => c.checked = src.checked); checkMassDeleteState(); }
        function checkMassDeleteState() {
            const n = document.querySelectorAll('.row-check:checked').length, btn = document.getElementById('dockDelete');
            if(n > 0) btn.classList.add('active'); else btn.classList.remove('active');
        }
        async function massDelete() {
            const chk = document.querySelectorAll('.row-check:checked');
            if(!chk.length || !confirm("Hapus terpilih?")) return;
            const idxs = Array.from(chk).map(c => parseInt(c.value)).sort((a,b)=>b-a);
            idxs.forEach(i => localUsers.splice(i, 1));
            renderAdminTable(); document.getElementById('checkAll').checked = false; await pushToBinAll();
        }

        async function massDeleteByCode() {
            const codeToDelete = document.getElementById('filterKode').value.trim();
            if(!codeToDelete) return alert("Masukkan Kode Referral yang mau dihapus!");
            
            const count = localUsers.filter(u => u.code.toLowerCase() === codeToDelete.toLowerCase()).length;
            if(count === 0) return alert("Tidak ada data dengan kode ini.");

            if(!confirm(`âš ï¸ PERINGATAN: Anda akan menghapus ${count} data dengan kode '${codeToDelete}'.\n\nTindakan ini tidak bisa dibatalkan. Yakin?`)) return;

            localUsers = localUsers.filter(u => u.code.toLowerCase() !== codeToDelete.toLowerCase());
            
            renderAdminTable();
            closeAction('filter');
            await pushToBinAll();
            alert(`Berhasil menghapus ${count} data.`);
        }

        async function pushToBinAll() {
            await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, { method: 'PUT', headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY }, body: JSON.stringify({ users: localUsers, codes: localCodes }) });
        }

        function copyFilteredEmails() {
            const filter = document.getElementById('filterKode').value.toLowerCase();
            const emails = localUsers.filter(u => u.code.toLowerCase() === filter).map(u => u.email).join(', ');
            if(emails) navigator.clipboard.writeText(emails).then(() => { alert("Disalin!"); closeAction('filter'); });
            else alert("Tidak ada data");
        }

        function updateCard() {
            const val = document.getElementById('reqCode').value;
            document.getElementById('displayCardCode').innerText = val ? val : 'ZEN-MEMBER';
        }

        function laporWa() {
            const k = document.getElementById('lapKode').value, e = document.getElementById('lapEmail').value.trim();
            if(localUsers.some(u => u.email.toLowerCase() === e.toLowerCase())) return alert('Email sudah tercatat silahkan cek di menu database');
            const text = `Berhasil Undang\n\nKode : ${k}\nEmail : ${e}`;
            window.open(`https://wa.me/6289513304878?text=${encodeURIComponent(text)}`);
        }
        function joinWa() {
            const k = document.getElementById('reqCode').value;
            const t = document.getElementById('reqTarget').value;
            if(!k) return alert("Isi kode unik dulu!");
            const text = `ðŸš€ *NEW AGENT REGISTRATION*\n\nHalo Admin Zen, saya siap bergabung jadi partner!\n\nðŸ†” Request Kode: *${k}*\nðŸŽ¯ Target: *${t || '10'}* User / Minggu\n\nMohon aksesnya segera diaktifkan. Terima kasih!`;
            window.open(`https://wa.me/6289513304878?text=${encodeURIComponent(text)}`);
        }
        function calc() {
            let t = parseInt(document.getElementById('reqTarget').value)||0;
            let pct = (t / 20) * 100;
            if(pct > 100) pct = 100;
            document.getElementById('calcProgress').style.width = pct + "%";
            
            // --- NEW CALC LOGIC ---
            let pairs = Math.floor(t / 2);
            let remainder = t % 2;
            let total = (pairs * 112000) + (remainder * 48000); // 112rb = 48 + 64

            const badge = document.getElementById('calcRateBadge');
            const breakdown = document.getElementById('calcBreakdownText');
            const bonus = document.getElementById('calcBonus');
            const bar = document.getElementById('calcProgress');

            // Set badge active style permanen karena looping
            badge.innerText = "Zigzag 48rb/64rb";
            badge.classList.add("active-gold"); 
            bar.classList.add("full");
            bonus.style.display = 'none'; // Disable bonus fixed karena sistemnya looping

            breakdown.innerText = `${pairs} Pasang (112rb) + ${remainder} x 48rb`;
            
            document.getElementById('calcTotal').innerText = new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',minimumFractionDigits:0}).format(total);
        }

        fetchPublicData();
    </script>
</body>
</html>
